"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,o=Array(e.length);t<e.length;t++)o[t]=e[t];return o}return Array.from(e)}function Blackbaud_Init(e){bbCheckout2_0.preloadInit(e)}function Blackbaud_Open(e){bbCheckout2_0.preloadOpen(e)}function Blackbaud_OpenPaymentForm(e){bbCheckout2_0.validateAndSubmit(e,0)}function Blackbaud_OpenCardNotPresentForm(e){bbCheckout2_0.validateAndSubmit(e,0)}function Blackbaud_OpenCardPresentForm(e){bbCheckout2_0.validateAndSubmit(e,1)}function Blackbaud_OpenDirectDebitForm(e){bbCheckout2_0.validateAndSubmit(e,9)}function Blackbaud_OpenStoreCardForm(e){bbCheckout2_0.validateAndSubmit(e,101)}function Blackbaud_OpenUpdateCardForm(e){bbCheckout2_0.validateAndSubmit(e,102)}function Blackbaud_OpenStoreDirectDebitForm(e){bbCheckout2_0.validateAndSubmit(e,103)}function Blackbaud_OpenUpdateDirectDebitForm(e){bbCheckout2_0.validateAndSubmit(e,104)}var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n])}return e},bbCheckout2_0=bbCheckout2_0||function(){function e(){var e=document.createElement("div"),o=["position: fixed","display: none","opacity: 0","right: 0","bottom: 0","left: 0","top: 0","-webkit-overflow-scrolling: touch","overflow-y: auto","z-index: 9999","transition: opacity .15s ease-in-out","-moz-transition: opacity .15s ease-in-out","-webkit-transition: opacity .15s ease-in-out","transform: translate3d(0,0,0)"].join(";");e.id=D,e.innerHTML='<link rel="stylesheet" type="text/css" href="'+R+'/Checkout/bbCheckout.2.0.css" media="all">',e.setAttribute("style",o);var n=document.createElement("div");n.id="bbcheckout-background-overlay",e.appendChild(n);var a=document.createElement("div");a.id=O,a.innerHTML='<div id="bbcheckout-spinner"><div></div></div>',e.appendChild(a);var r=0===window.innerHeight?600:window.innerHeight,i=document.createElement("iframe"),d=["z-index: 9999","opacity: 1","transition: opacity .15s ease-in-out","-moz-transition: opacity .15s ease-in-out","-webkit-transition: opacity .15s ease-in-out","border: 0px none transparent","overflow-x: hidden","overflow-y: auto","visibility: visible","margin: 0","padding: 0","-webkit-tap-highlight-color: transparent","position: fixed","left: 0","top: 0","right: 0","bottom: 0","width: 100%","height:"+r+"px"].join(";");i.setAttribute("style",d),i.setAttribute("data-bbauto-field","bbCheckoutPaymentIframe"),i.id=F,i.setAttribute("allowpaymentrequest",""),i.addEventListener("load",t),e.appendChild(i),document.body.appendChild(e),window.onresize=function(){i.style.height=window.innerHeight+"px"}}function t(){var e=document.getElementById(F);e&&e.contentWindow.focus()}function o(e,t){e&&t&&(e=c(e,t),document.getElementById(F).src=e)}function n(e){return e.charAt(0).toUpperCase()+e.substr(1)}function a(e){var t,o,r,i={};for(t in e)e.hasOwnProperty(t)&&(o=n(t.replace(/_\w/g,function(e){return e[1].toUpperCase()})),r=e[t],r&&r.constructor===Object&&(r=a(r)),i[o]=r);return i}function r(e){return(e.AccountToken||e.CardToken)&&(e.CardToken=e.AccountToken||e.CardToken,delete e.AccountToken),(e.Accountholder||e.Cardholder)&&(e.Cardholder=e.Accountholder||e.Cardholder,delete e.Accountholder),e}function i(e){return 9===e||103===e||104===e}function d(){var e=document.getElementById(D);return!!e&&"block"===e.style.display}function c(e,t){return t.PrimaryColor&&(e+="&pc="+t.PrimaryColor),t.SecondaryColor&&(e+="&sc="+t.SecondaryColor),t.FontFamily&&(e+="&ff="+t.FontFamily),t.FontColor&&(e+="&fc="+t.FontColor),t.UseApplePayDonateButton&&(e+="&db=true"),window.ApplePaySession&&(e+="&apd=true"),e+="&v=2.0"}function u(){var e=document.getElementById(F),t=e.parentNode;t.removeChild(e),e.src="about:blank",t.appendChild(e)}function l(e){return["input","textarea","select"].indexOf(e.tagName.toLowerCase())>-1}function s(e){var t={BillingAddress:{}};for(var o in e)e.hasOwnProperty(o)&&""!==e[o]&&(o.indexOf("BillingAddress")>=0?t.BillingAddress[o.replace("BillingAddress","")]=e[o]:t[o]=e[o]);return t}function p(e){var t=document.querySelectorAll('input[name="transactiontoken"]');if(t&&t.length>0)t[t.length-1].value=e;else{var o=document.querySelector("form[data-formtype='bbCheckout']"),n=document.createElement("input");n.type="hidden",n.name="transactiontoken",n.value=e,o?o.appendChild(n):document.body.appendChild(n)}}function m(e){var t=document.createElement("a");return t.href=e,t.hostname}function y(){T=document.body.style.position,I=document.body.style.overflow,document.body.style.overflow="hidden",document.body.style.position="fixed"}function h(){document.body.style.overflow=I,document.body.style.position=T}function f(e){var t=document.getElementById("visa-update");if(e&&e.length>0)if(t)t.src=e;else{var o=document.createElement("img");o.id="visa-update",o.src=e,document.body.appendChild(o)}}function C(e){var t=document.getElementById(F),o=!0;if(window.location!==window.parent.location&&window.location.hostname!==m(document.referrer)&&(o=!1),window.ApplePaySession&&o&&ApplePaySession.canMakePayments()){ApplePaySession.canMakePaymentsWithActiveCard(e.merchantId).then(function(e){t.contentWindow.postMessage({Command:"ApplePayReady",Args:e},"*")},function(){t.contentWindow.postMessage({Command:"ApplePayReady",Args:!1},"*")})}else t.contentWindow.postMessage({Command:"ApplePayReady",Args:!1},"*")}function b(e){_=new ApplePaySession(1,e);var t=document.getElementById(F);_.onvalidatemerchant=function(e){var o={eventValidationUrl:e.validationURL,domainName:location.hostname};t.contentWindow.postMessage({Command:"ApplePayValidate",Args:o},"*")},_.onpaymentauthorized=function(e){t.contentWindow.postMessage({Command:"ApplePayDecrypt",Args:e.payment},"*")},_.oncancel=function(){},_.begin()}function v(e){_.completeMerchantValidation(e)}function k(e){var t="success"===e?ApplePaySession.STATUS_SUCCESS:ApplePaySession.STATUS_FAILURE;_.completePayment(t)}function w(e){window.addEventListener("beforeunload",A);var t=JSON.parse(e),o=void 0;return S.win=window.open(t.url,"checkoutPopup","toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+t.w+", height="+t.h+", top="+t.y+", left="+t.x),S.url=t.url,S.win&&(o=setInterval(function(){S&&S.win&&S.win.closed&&(clearInterval(o),document.getElementById(F).contentWindow.postMessage({Command:"MasterpassClosed"},R))},1e3)),S.win}function A(){S.win?S.win.close():document.getElementById(F).contentWindow.postMessage({Command:"MasterpassClosed"},R),window.removeEventListener("beforeunload",A)}function E(){B&&S.win?(S.win.close(),w(JSON.stringify({url:S.url}))):S.win&&window.open("","checkoutPopup")}function g(){var e=window.addEventListener?"addEventListener":"attachEvent";(0,window[e])("attachEvent"==e?"onmessage":"message",function(e){var t=e.message?"message":"data",o=e[t],n=e.origin||e.originalEvent.origin,a=m(n),r=m(R);!function(e){var t={PaymentReady:P.handlePaymentReady,PaymentComplete:P.handlePaymentComplete,PaymentCancel:P.handlePaymentCancel,PaymentExpired:P.handlePaymentExpired,VisaUpdate:f,ApplePayCheck:C,ApplePayClicked:b,ApplePayValidateComplete:v,ApplePayPaymentComplete:k,OpenPopup:w,ClosePopup:A,FocusPopup:E};a.toLowerCase()===r.toLowerCase()&&"function"==typeof t[e.Command]&&(e.Args?t[e.Command](e.Args):t[e.Command]())}(o)},!1)}var P={_isCheckoutFormLoaded:!1,_isPreloaded:!1,_preLoadData:null,_shouldShowCheckout:!1,_isInitialized:!1,_postLoadData:null,_preloadError:null},_=null,S={},T=void 0,I=void 0,F="bbcheckout-iframe",D="bbcheckout-iframe-wrapper",O="bbcheckout-loader-wrapper",B=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,R="https://payments.blackbaud.com",N={NETWORK_ERROR:1001,MISSING_PUB_KEY:1003,INVALID_DATA:1004,ENDPOINT_ERROR:1005,UNSUPPORTED_BROWSER:1006,MISSING_MERCHANT_ID:1007,MISSING_CLIENT_APP_NAME:1008,MISSING_TRANS_TYPE:1009,INVALID_AMOUNT:1010},M={CARD_NOT_PRESENT:0,CARD_PRESENT:1,DIRECT_DEBIT:9,STORE_CARD:101,UPDATE_CARD:102,STORE_DIRECT_DEBIT:103,UPDATE_DIRECT_DEBIT:104};return P.loadCheckoutForm=function(e){var t=document.getElementById(D);P._shouldShowCheckout&&t&&(t.style.display="block",t.style.opacity="1"),P.getCheckoutPageUrl(e,o)},P.closeCheckoutForm=function(e){var t=document.getElementById(D);t.style.opacity="0",document.getElementById(O).style.opacity="1",B&&h(),setTimeout(function(){t.style.display="none",P._isCheckoutFormLoaded=!1,e()},500)},P.showCheckoutForm=function(){var e=document.getElementById(D),t=document.getElementById(F);P._isCheckoutFormLoaded&&(P._isPreloaded&&P._postLoadData&&P.updatePreloadedData(P._postLoadData),window.scrollTo(0,0),B&&y(),t&&(t.style.display="block",e.style.display="block",e.style.opacity=1,t.contentWindow.focus(),setTimeout(function(){document.getElementById(O).style.opacity="0"},500),t.contentWindow.postMessage({Command:"animateDisplay",Args:{version:"2.0",preloaded:P._isPreloaded,delay:P._isPreloaded?"0":"400",transition:P._isPreloaded?"0.2":"0.4"}},R)))},P.getCheckoutPageUrl=function(e,t){var o=void 0,n=void 0,a=void 0;o=new XMLHttpRequest,n="Basic "+btoa("TOKENUSER:"+e.Key),o.open("POST",R+"/api/Checkout"),o.setRequestHeader("Content-Type","application/json"),o.setRequestHeader("Accept","application/json"),o.setRequestHeader("Authorization",n),o.onload=function(){if(200===o.status)a=JSON.parse(o.responseText),p(a.Token),t(a.ProcessURI,e),P._preloadError=null,P.triggerCustomEvent("checkoutLoaded");else{var n="An error occurred calling the Checkout endpoint.",r=N.NETWORK_ERROR;o&&(400===o.status?(n+=" A supplied data-key was invalid.",r=N.INVALID_DATA):(n+=" The endpoint returned a status of "+o.status+" ("+o.statusText+").",n+=" The response was: "+o.responseText,r=N.ENDPOINT_ERROR)),P.handleCheckoutError(n,!0,r),P._preloadError=n,document.getElementById(D).style.display="none"}},o.send(JSON.stringify(e))},P.parseTransactionData=function(e){var t=void 0;t=_extends(P.readFormFields(),e),i(t.SourceCode)&&(t=r(t)),t=a(t),t.Key=t.Key||t.key,t.MerchantAccountId=t.MerchantAccountID||t.MerchantAccountId,t.MerchantAccountId=t.MerchantAccountId||t.PaymentConfigurationId,t=s(t),t.SourceCode=t.SourceCode||0,t.UseVisaCheckout=P.isWalletEnabled(t,"UseVisaCheckout"),t.UseApplePay=P.isWalletEnabled(t,"UseApplePay"),t.UseMasterpass=P.isWalletEnabled(t,"UseMasterpass"),t.UsePayPal=P.isWalletEnabled(t,"UsePayPal"),t.Amount=t.Amount?String(t.Amount).replace(/[^\d.,]/g,""):"",t.ClientDomain=location.hostname;var o=/([^a-zA-Z\d\s])/g;return t.PrimaryColor=t.hasOwnProperty("PrimaryColor")?t.PrimaryColor.replace(o,""):"",t.SecondaryColor=t.hasOwnProperty("SecondaryColor")?t.SecondaryColor.replace(o,""):"",t.FontColor=t.hasOwnProperty("FontColor")?t.FontColor.replace(o,""):"",t.FontFamily=t.hasOwnProperty("FontFamily")?t.FontFamily:"",t.UseApplePayDonateButton=!(!t.hasOwnProperty("UseApplePayDonateButton")||!t.UseApplePayDonateButton),t},P.validateAndSubmit=function(e,t){P._isInitialized||P.init(),e.SourceCode=t,e=P.parseTransactionData(e),P.isValidTransactionData(e)&&(P._shouldShowCheckout=!0,P.loadCheckoutForm(e))},P.isValidTransactionData=function(e){return e.Key&&""!==e.Key?!P.isPaymentTransaction(e)||e.MerchantAccountId&&""!==e.MerchantAccountId?!([0,1,9,101,102,103,104].indexOf(e.SourceCode)<=-1)||(P.handleCheckoutError("Invalid value was supplied for transaction type.",!0,N.MISSING_TRANS_TYPE),!1):(P.handleCheckoutError("No value was supplied for merchant account id.",!0,N.MISSING_MERCHANT_ID),!1):(P.handleCheckoutError("No value was supplied for public key.",!0,N.MISSING_PUB_KEY),!1)},P.isValidPostLoadTransactionData=function(e){return!(P.isPaymentTransaction(P._preLoadData)&&!P.isValidAmount(e.Amount))||(P.handleCheckoutError("Invalid value was supplied for amount.",!0,N.INVALID_AMOUNT),!1)},P.isValidAmount=function(e){var t=/[,.\$\xA2-\xA5\u058F\u060B\u09F2\u09F3\u09FB\u0AF1\u0BF9\u0E3F\u17DB\u20A0-\u20BD\uA838\uFDFC\uFE69\uFF04\uFFE0\uFFE1\uFFE5\uFFE6]/g,o=e?String(e).replace(t,""):e;return!isNaN(o)&&Number(o)>0},P.isPaymentTransaction=function(e){return 0===e.SourceCode||1===e.SourceCode||9===e.SourceCode},P.isWalletEnabled=function(e,t){return 0===e.SourceCode&&(!e.hasOwnProperty(t)||null===e[t]||"false"!==String(e[t]).toLowerCase())},P.handleCheckoutError=function(e,t,o){t&&alert("An error prevented the payment form from opening. Please contact the organization directly to arrange payment."),console.error(e),P.triggerCustomEvent("checkoutError",{detail:{errorText:e,errorCode:o}})},P.handlePaymentReady=function(){P._isCheckoutFormLoaded=!0,P._isPreloaded&&document.getElementById(F).contentWindow.postMessage({Command:"trackPreloaded"},R),P._shouldShowCheckout&&P.showCheckoutForm()},P.handlePaymentComplete=function(){var e=document.querySelector("form[data-formtype='bbCheckout']"),t=document.querySelectorAll("input[name='transactiontoken']");P.triggerCustomEvent("checkoutComplete",{detail:{transactionToken:t[t.length-1].value}}),e&&!e.dataset.disableSubmit&&e.submit(),P.closeCheckoutForm(function(){u(),P.resetPreloadState()})},P.handlePaymentCancel=function(){P.closeCheckoutForm(function(){P.triggerCustomEvent("checkoutCancel"),u()})},P.handlePaymentExpired=function(e){e&&d()&&alert(e),P.closeCheckoutForm(function(){u(),P.triggerCustomEvent("checkoutExpired"),P._isPreloaded&&P.resetPreloadState()})},P.resetPreloadState=function(){document.getElementById(F).src="about:blank",P._isCheckoutFormLoaded=!1},P.updatePreloadedData=function(e){document.getElementById(F).contentWindow.postMessage({Command:"UpdatePreloadedData",Args:e},R)},P.readFormFields=function(){var e={},t=void 0;return t=document.querySelector('form[data-formtype="bbCheckout"][data-key]'),t&&""!==t.getAttribute("data-key")&&(e.Key=t.getAttribute("data-key")),[].concat(_toConsumableArray(document.querySelectorAll('form[data-formtype="bbCheckout"] [data-checkout-field]'))).forEach(function(t){if(l(t)&&t.value&&!t.disabled){if("checkbox"===t.type)return void(e[t.dataset.checkoutField]=t.checked);if("radio"===t.type)return void(t.checked&&(e[t.dataset.checkoutField]=t.value));e[t.dataset.checkoutField]=t.value}}),e},P.triggerCustomEvent=function(e,t){setTimeout(function(){var o=t||{},n=new CustomEvent(e,o);if(document.dispatchEvent(n),window.jQuery)try{"checkoutError"===e&&window.jQuery(document).trigger("checkoutError",[o.detail.errorText,o.detail.errorCode]),"checkoutComplete"===e&&window.jQuery(document).trigger("checkoutComplete",[o.detail.transactionToken])}catch(e){}},0)},P.preloadInit=function(e,t){P._isInitialized||P.init(),P._shouldShowCheckout=t||!1,P._preLoadData||(P._preLoadData=P.parseTransactionData(e)),P._preLoadData.SourceCode=e.TransactionType&&e.TransactionType.toUpperCase()in M?M[e.TransactionType.toUpperCase()]:0,P._preLoadData.Amount=P.isPaymentTransaction(P._preLoadData)?.01:0,P.isValidTransactionData(P._preLoadData)&&(P._isPreloaded=!0,P.loadCheckoutForm(P._preLoadData))},P.preloadOpen=function(e){if(!P._isPreloaded||P._preloadError)return console.warn("Checkout failed to initialize. "),void(P._preloadError&&console.warn(P._preloadError));"about:blank"===document.getElementById(F).src&&P.preloadInit(P._preLoadData,!0),P._postLoadData=P.parseTransactionData(e),P.isValidPostLoadTransactionData(P._postLoadData)&&(P._shouldShowCheckout=!0,P._isCheckoutFormLoaded&&P.showCheckoutForm())},P.init=function(){if(!P._isInitialized){if("undefined"==typeof JSON||"undefined"==typeof btoa)return void P.handleCheckoutError("This browser is not supported.",!1,N.UNSUPPORTED_BROWSER);P._isInitialized=!0,g(),e(),P.triggerCustomEvent("checkoutReady")}},P}();document.addEventListener("DOMContentLoaded",function(){bbCheckout2_0.init()}),function(){function e(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var o=document.createEvent("CustomEvent");return o.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),o}if("function"==typeof window.CustomEvent)return!1;e.prototype=window.Event.prototype,window.CustomEvent=e}(),Array.from||(Array.from=function(){var e=Object.prototype.toString,t=function(t){return"function"==typeof t||"[object Function]"===e.call(t)},o=function(e){var t=Number(e);return isNaN(t)?0:0!==t&&isFinite(t)?(t>0?1:-1)*Math.floor(Math.abs(t)):t},n=Math.pow(2,53)-1,a=function(e){var t=o(e);return Math.min(Math.max(t,0),n)};return function(e){var o=this,n=Object(e);if(null==e)throw new TypeError("Array.from requires an array-like object - not null or undefined");var r,i=arguments.length>1?arguments[1]:void 0;if(void 0!==i){if(!t(i))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(r=arguments[2])}for(var d,c=a(n.length),u=t(o)?Object(new o(c)):new Array(c),l=0;l<c;)d=n[l],u[l]=i?void 0===r?i(d,l):i.call(r,d,l):d,l+=1;return u.length=c,u}}());
//# sourceMappingURL=bbCheckout.2.0.js.map
